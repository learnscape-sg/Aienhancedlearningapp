import{R as y,r as h,M as j,j as t,a as k,u as R,b as S,c as v,i as T,B as W,C as P,d as B,H as C,P as N}from"./index-CTGzGgMl.js";const D=({data:n,selected:p})=>{const o=n;return t.jsxs("div",{className:`px-4 py-3 shadow-md rounded-lg border-2 transition-all ${o.isConfusion?"bg-amber-50 border-amber-500":"bg-white border-indigo-500"} ${p?"ring-2 ring-cyan-500 ring-offset-2":""}`,style:{minWidth:"120px"},children:[t.jsx(C,{type:"target",position:N.Top,className:"!bg-indigo-500 !w-3 !h-3 !border-2 !border-white",style:{borderRadius:"50%"}}),t.jsxs("div",{className:"text-sm font-medium text-slate-800 text-center",children:[o.isConfusion&&"❓ ",o.label]}),t.jsx(C,{type:"source",position:N.Bottom,className:"!bg-indigo-500 !w-3 !h-3 !border-2 !border-white",style:{borderRadius:"50%"}})]})},z={default:D},A=({initialNodes:n,initialEdges:p,onChange:o,editable:r})=>{const[l,w,m]=R(n),[d,g,i]=S(p),a=h.useCallback((s,u)=>{if(!o)return;const b=s.map(e=>({id:e.id,label:String(e.data.label||""),type:e.data.isConfusion?"confusion":"concept",position:e.position})),f=u.map(e=>({id:e.id,source:e.source,target:e.target,label:typeof e.label=="string"?e.label:e.label?String(e.label):void 0,type:"hierarchical"})),x={type:"mindmap",nodes:b,edges:f,metadata:{centralConcept:String(s[0]?.data.label||"Root"),confusionPoints:s.filter(e=>e.data.isConfusion).map(e=>String(e.data.label||""))}};o(x)},[o]),E=h.useCallback(s=>{if(!r||!s.source||!s.target)return;const u=v(s,d);g(u),a(l,u)},[r,d,l,g,a]),c=y.useRef(null),M=h.useCallback(s=>{m(s),r&&o&&typeof window<"u"&&(c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{const u=l.map(b=>{const f=s.find(x=>x.id===b.id);return f&&f.type==="position"&&f.position?{...b,position:f.position}:b});a(u,d),c.current=null},100))},[m,l,d,r,o,a]);return y.useEffect(()=>()=>{c.current&&clearTimeout(c.current)},[]),t.jsxs(T,{nodes:l,edges:d,nodeTypes:z,onNodesChange:M,onEdgesChange:i,onConnect:E,fitView:!0,className:"bg-slate-50",connectionLineStyle:{stroke:"#6366f1",strokeWidth:2},defaultEdgeOptions:{type:"smoothstep",animated:!1,style:{strokeWidth:2,stroke:"#6366f1"},markerEnd:{type:j.ArrowClosed,width:20,height:20}},children:[t.jsx(W,{color:"#e5e7eb",gap:16}),t.jsx(P,{className:"bg-white border border-slate-200 rounded-lg shadow-sm"}),r&&t.jsx(B,{className:"bg-white border border-slate-200 rounded-lg shadow-sm",nodeColor:s=>s.data.isConfusion?"#f59e0b":"#6366f1"})]})},I=({data:n,onChange:p,editable:o=!1})=>{const[r,l]=y.useState(!1);y.useEffect(()=>{l(!0)},[]);const{initialNodes:w,initialEdges:m}=h.useMemo(()=>{const d=n.nodes.length>0?n.nodes.map((i,a)=>({id:i.id,type:"default",position:i.position||(a===0?{x:400,y:300}:{x:400+a%3*250,y:300+Math.floor(a/3)*200}),data:{label:i.label,isConfusion:i.type==="confusion"}})):[{id:"root",type:"default",position:{x:400,y:300},data:{label:n.metadata?.centralConcept||"中心概念",isConfusion:!1}}],g=n.edges.map(i=>({id:i.id,source:i.source,target:i.target,label:i.label||"",markerEnd:{type:j.ArrowClosed,width:20,height:20},style:{strokeWidth:2,stroke:"#6366f1"},labelStyle:{fill:"#64748b",fontWeight:500,fontSize:"12px"}}));return{initialNodes:d,initialEdges:g}},[n]);return r?t.jsx(k,{children:t.jsx("div",{className:"w-full h-full",children:t.jsx(A,{initialNodes:w,initialEdges:m,onChange:p,editable:o})})}):t.jsx("div",{className:"w-full h-full flex items-center justify-center bg-slate-50",children:t.jsx("div",{className:"text-sm text-slate-400",children:"正在加载思维导图..."})})};export{I as MindMapRenderer};
